<!--Pagina de login-->

<!DOCTYPE html>
<html>
<head>
    <title>Cadastro de Empresa</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="../assets/styles.css">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
    <style>
        .required::after {
            content: " *";
            color: red;
        }
        .error-message {
            color: red;
            text-align: center;
            margin-top: 10px;
            display: none;
        }
        .btn {
            color: black !important;
        }
        .container {
            margin-bottom: 5vh;
        }
        .password-toggle {
            cursor: pointer;
            position: absolute;
            right: 10px;
            top: 50%;
            transform: translateY(-50%);
        }
        .password-field {
            position: relative;
        }
    </style>
</head>
<body>

    <nav class="navbar">
        <div class="container-fluid">
          <a class="navbar-brand" href="">
            <i class="fa-solid fa-beer-mug-empty"></i>
            Worklink
          </a>
        </div>
    </nav>

    <div class="container">
        <div class="row" style="margin-top: 5vh;">
            <div class="col-md-2"></div>
            <div class="col-md-8">
                <div class="card shadow" style="padding: 2rem; border-radius: 10px;">
                    <h1 class="text-center mb-4">Cadastro de Empresa</h1>
                    
                    <form id="formCadastroEmpresa">
                        <div class="form-section">
                            <h3>Dados da Empresa</h3>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="razaoSocial">Razão Social</label>
                                    <input type="text" class="form-control" id="razaoSocial" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="cnpj">CNPJ</label>
                                    <input type="text" class="form-control" id="cnpj" required>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="email">Email Corporativo</label>
                                    <input type="email" class="form-control" id="email" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="telefone">Telefone</label>
                                    <input type="tel" class="form-control" id="telefone" required>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Endereço</h3>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="cep">CEP</label>
                                    <input type="text" class="form-control" id="cep" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="cidade">Cidade</label>
                                    <input type="text" class="form-control" id="cidade" required readonly>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-8 mb-3">
                                    <label for="endereco">Endereço</label>
                                    <input type="text" class="form-control" id="endereco" required readonly>
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="numero">Número</label>
                                    <input type="text" class="form-control" id="numero" required>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Dados do Responsável</h3>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="nomeResponsavel">Nome do Responsável</label>
                                    <input type="text" class="form-control" id="nomeResponsavel" required>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="cargo">Cargo</label>
                                    <input type="text" class="form-control" id="cargo" required>
                                </div>
                            </div>
                        </div>

                        <div class="form-section">
                            <h3>Segurança</h3>
                            <div class="row">
                                <div class="col-md-6 mb-3">
                                    <label for="senha">Senha</label>
                                    <div class="password-field">
                                        <input type="password" class="form-control" id="senha" required>
                                        <i class="fas fa-eye password-toggle" onclick="togglePassword('senha')"></i>
                                    </div>
                                </div>
                                <div class="col-md-6 mb-3">
                                    <label for="confirmarSenha">Confirmar Senha</label>
                                    <div class="password-field">
                                        <input type="password" class="form-control" id="confirmarSenha" required>
                                        <i class="fas fa-eye password-toggle" onclick="togglePassword('confirmarSenha')"></i>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="text-center mt-4">
                            <button type="submit" class="btn btn-primary btn-lg">Cadastrar</button>
                        </div>
                    </form>
                </div>
            </div>
            <div class="col-md-2"></div>
        </div>
    </div>

    <script>
        // Formatação do CNPJ (XX.XXX.XXX/XXXX-XX)
        $('#cnpj').on('input', function() {
            let cnpj = this.value.replace(/\D/g, '');
            cnpj = cnpj.replace(/^(\d{2})(\d)/, '$1.$2');
            cnpj = cnpj.replace(/^(\d{2})\.(\d{3})(\d)/, '$1.$2.$3');
            cnpj = cnpj.replace(/\.(\d{3})(\d)/, '.$1/$2');
            cnpj = cnpj.replace(/(\d{4})(\d)/, '$1-$2');
            this.value = cnpj.slice(0, 18);
        });

        // Formatação do telefone ((XX) XXXXX-XXXX)
        $('#telefone').on('input', function() {
            let telefone = this.value.replace(/\D/g, '');
            telefone = telefone.replace(/^(\d{2})(\d)/g, '($1) $2');
            telefone = telefone.replace(/(\d)(\d{4})$/, '$1-$2');
            this.value = telefone.slice(0, 15);
        });

        // Formatação do CEP (XXXXX-XXX) e busca automática do endereço
        $('#cep').on('blur', function() {
            let cep = this.value.replace(/\D/g, '');
            
            // Verifica se o CEP tem 8 dígitos
            if (cep.length === 8) {
                // Mostra um indicador de carregamento
                $('#cidade').val('Buscando...');
                $('#endereco').val('Buscando...');

                // Faz a requisição para a API do ViaCEP
                fetch(`https://viacep.com.br/ws/${cep}/json/`)
                    .then(response => response.json())
                    .then(data => {
                        if (!data.erro) {
                            // Preenche os campos com os dados retornados
                            $('#cidade').val(data.localidade);
                            $('#endereco').val(data.logradouro);
                        } else {
                            // Se houver erro, limpa os campos
                            $('#cidade').val('');
                            $('#endereco').val('');
                            alert('CEP não encontrado');
                        }
                    })
                    .catch(error => {
                        console.error('Erro ao buscar CEP:', error);
                        $('#cidade').val('');
                        $('#endereco').val('');
                        alert('Erro ao buscar CEP');
                    });
            }
        });

        // Formatação do CEP enquanto digita
        $('#cep').on('input', function() {
            let cep = this.value.replace(/\D/g, '');
            cep = cep.replace(/^(\d{5})(\d)/, '$1-$2');
            this.value = cep.slice(0, 9);
        });

        // Função para mostrar/ocultar senha
        function togglePassword(inputId) {
            const input = document.getElementById(inputId);
            const icon = input.nextElementSibling;
            
            if (input.type === 'password') {
                input.type = 'text';
                icon.classList.remove('fa-eye');
                icon.classList.add('fa-eye-slash');
            } else {
                input.type = 'password';
                icon.classList.remove('fa-eye-slash');
                icon.classList.add('fa-eye');
            }
        }

        // Envio do formulário
        $('#formCadastroEmpresa').on('submit', function(e) {
            e.preventDefault();
            
            // Coleta todos os dados do formulário
            const dadosEmpresa = {
                razaoSocial: $('#razaoSocial').val(),
                cnpj: $('#cnpj').val().replace(/\D/g, ''),
                email: $('#email').val(),
                telefone: $('#telefone').val().replace(/\D/g, ''),
                cep: $('#cep').val().replace(/\D/g, ''),
                cidade: $('#cidade').val(),
                endereco: $('#endereco').val(),
                numero: $('#numero').val(),
                nomeResponsavel: $('#nomeResponsavel').val(),
                cargo: $('#cargo').val(),
                senha: $('#senha').val()
            };

            // Envia os dados para o backend
            fetch('http://localhost:3000/api/empresas', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json'
                },
                body: JSON.stringify(dadosEmpresa)
            })
            .then(response => {
                if (!response.ok) {
                    throw new Error('Erro ao cadastrar empresa');
                }
                return response.json();
            })
            .then(data => {
                alert('Cadastro realizado com sucesso!');
                window.location.href = 'login.html';
            })
            .catch(error => {
                console.error('Erro:', error);
                alert('Erro ao realizar cadastro. Por favor, tente novamente.');
            });
        });
    </script>
</body>
</html>


